name: Claude Code Test
on:
    issue_comment:
        types: [created]

jobs:
    test:
        if: contains(github.event.comment.body, '@claude')
        runs-on: self-hosted
        permissions:
            contents: write
            issues: write
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
              
            - name: Test Claude API
              run: |
                echo "Claude API テスト開始"
                echo "Access Token: ${{ secrets.CLAUDE_ACCESS_TOKEN }}"
                echo "Refresh Token: ${{ secrets.CLAUDE_REFRESH_TOKEN }}"
                echo "Expires At: ${{ secrets.CLAUDE_EXPIRES_AT }}"
                echo "GitHub Token: ${{ secrets.GH_PAT }}"
                
            - name: Add comment to issue
              uses: actions/github-script@v7
              with:
                github-token: ${{ secrets.GH_PAT }}
                script: |
                  github.rest.issues.createComment({
                    issue_number: context.issue.number,
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    body: '🤖 テスト用ボットです。Claude Code の代わりに応答しています。'
                  })
